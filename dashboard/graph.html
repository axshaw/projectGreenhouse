<!doctype>
<link rel="stylesheet" href="rickshaw-master/rickshaw.min.css">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="rickshaw-master/vendor/d3.layout.min.js"></script>
<script src="rickshaw-master/rickshaw.min.js"></script>
<script src="rickshaw-master/src/js/Rickshaw.Fixtures.Time.js"></script>
<script src="rickshaw-master/src/js/Rickshaw.Graph.Axis.Time.js"></script>
<style>
#chart_container {
        position: relative;
        font-family: Arial, Helvetica, sans-serif;
}
#chart {
        position: relative;
        left: 40px;
}
#y_axis {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 40px;
}
</style>
<h2>Current: </h2>
<div id="chart_container">
        <div id="y_axis"></div>
        <div id="chart"></div>
</div>

<script>

var data = [];

var graphEnabled=false;
var graph;
var x_axis;
var y_axis;
var hoverDetail;
var highlighter;

function update(dataStream)	{
	console.log(dataStream);
	console.log(data);
	data.push(dataStream);
   // data.shift();

   if(graphEnabled==false) {
		 graph = new Rickshaw.Graph( {
		        element: document.querySelector("#chart"),
		        renderer: 'line',
		        width: 580,
		        height: 250,
		        series: [ {
		                color: 'steelblue',
		                data: data
		        } ]
		} );

		 x_axis = new Rickshaw.Graph.Axis.Time( { 
		 	graph: graph
		 } );

		 y_axis = new Rickshaw.Graph.Axis.Y( {
		        graph: graph,
		        orientation: 'left',
		        tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
		        element: document.getElementById('y_axis'),
		} );

		 hoverDetail = new Rickshaw.Graph.HoverDetail( {
			graph: graph
		} );

		highlighter = new Rickshaw.Graph.Behavior.Series.Highlight( {
			graph: graph
		} );

		graphEnabled = true;
	};

	 graph.render();
};



//var connection = new WebSocket("ws://192.168.42.48:8784");  
var connection = new WebSocket("ws://localhost:8181");  
connection.onopen = function(){  
    console.log('Socket has been opened!');  
} 
connection.onclose = function(){
   console.log('Connection closed');
}
connection.onmessage = function(msg){  
  var milliseconds = (new Date).getTime();
  var dataStream = {};
  	dataStream.x = milliseconds;
  	dataStream.y = parseFloat(msg.data);
  	update(dataStream);
    
    
   
}  
// Log errors
connection.onerror = function (error) {
  console.log('WebSocket Error ' + error);
};

</script>